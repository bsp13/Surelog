
<!DOCTYPE html>
<html>
<head>
<style>
body {

}
p {
font-size: 14px;
}</style>
<h3>./bp_me/src/v/cce/bp_cce_inst_decode.v Cov: 100% </h3>
<pre style="margin:0; padding:0 ">   1: /**</pre>
<pre style="margin:0; padding:0 ">   2:  *</pre>
<pre style="margin:0; padding:0 ">   3:  * Name:</pre>
<pre style="margin:0; padding:0 ">   4:  *   bp_cce_inst_decode.v</pre>
<pre style="margin:0; padding:0 ">   5:  *</pre>
<pre style="margin:0; padding:0 ">   6:  * Description:</pre>
<pre style="margin:0; padding:0 ">   7:  *   This module contains combinational logic to decode the current instruction, which</pre>
<pre style="margin:0; padding:0 ">   8:  *   is provided from the bp_cce_pc module.</pre>
<pre style="margin:0; padding:0 ">   9:  *</pre>
<pre style="margin:0; padding:0 ">  10:  */</pre>
<pre style="margin:0; padding:0 ">  11: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  12: module bp_cce_inst_decode</pre>
<pre style="margin:0; padding:0 ">  13:   import bp_common_pkg::*;</pre>
<pre style="margin:0; padding:0 ">  14:   import bp_cce_pkg::*;</pre>
<pre style="margin:0; padding:0 ">  15:   import bp_me_pkg::*;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  16:   #(parameter inst_width_p        = "inv"</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  17:     , parameter inst_addr_width_p = "inv"</pre>
<pre style="margin:0; padding:0 ">  18:   )</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  19:   (input                                         clk_i</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  20:    , input                                       reset_i</pre>
<pre style="margin:0; padding:0 ">  21: </pre>
<pre style="margin:0; padding:0 ">  22:    // Instruction from bp_cce_pc</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  23:    , input [inst_width_p-1:0]                    inst_i</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  24:    , input                                       inst_v_i</pre>
<pre style="margin:0; padding:0 ">  25: </pre>
<pre style="margin:0; padding:0 ">  26:    // Pending bit write busy from bp_cce_msg</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  27:    , input                                       pending_w_busy_i</pre>
<pre style="margin:0; padding:0 ">  28:    // LCE Command busy from bp_cce_msg</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  29:    , input                                       lce_cmd_busy_i</pre>
<pre style="margin:0; padding:0 ">  30: </pre>
<pre style="margin:0; padding:0 ">  31:    // input queue valid signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  32:    , input                                       lce_req_v_i</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  33:    , input                                       lce_resp_v_i</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  34:    , input bp_lce_cce_resp_type_e                lce_resp_type_i</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  35:    , input                                       mem_resp_v_i</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  36:    , input                                       mem_cmd_v_i</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  37:    , input                                       pending_v_i</pre>
<pre style="margin:0; padding:0 ">  38: </pre>
<pre style="margin:0; padding:0 ">  39:    // ready_i signals for output queues</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  40:    , input                                       lce_cmd_ready_i</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  41:    , input                                       mem_cmd_ready_i</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  42:    , input                                       mem_resp_ready_i</pre>
<pre style="margin:0; padding:0 ">  43: </pre>
<pre style="margin:0; padding:0 ">  44:    // fence zero</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  45:    , input                                       fence_zero_i</pre>
<pre style="margin:0; padding:0 ">  46: </pre>
<pre style="margin:0; padding:0 ">  47:    // Decoded instruction</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  48:    , output bp_cce_inst_decoded_s                decoded_inst_o</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  49:    , output logic                                decoded_inst_v_o</pre>
<pre style="margin:0; padding:0 ">  50: </pre>
<pre style="margin:0; padding:0 ">  51:    // Control to bp_cce_pc</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  52:    , output logic                                pc_stall_o</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  53:    , output logic [inst_addr_width_p-1:0]        pc_branch_target_o</pre>
<pre style="margin:0; padding:0 ">  54:   );</pre>
<pre style="margin:0; padding:0 ">  55: </pre>
<pre style="margin:0; padding:0 ">  56:   // Suppress unused signal warning</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  57:   wire unused0 = clk_i;</pre>
<pre style="margin:0; padding:0 ">  58: </pre>
<pre style="margin:0; padding:0 ">  59:   // Instruction Fields</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  60:   bp_cce_inst_s                inst;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  61:   bp_cce_inst_op_e             op;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  62:   bp_cce_inst_minor_op_u       minor_op_u;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  63:   bp_cce_inst_type_u           op_type_u;</pre>
<pre style="margin:0; padding:0 ">  64:   // Instruction types</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  65:   bp_cce_inst_alu_op_s         alu_op_s;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  66:   bp_cce_inst_branch_op_s      branch_op_s;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  67:   bp_cce_inst_mov_op_s         mov_op_s;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  68:   bp_cce_inst_flag_op_s        flag_op_s;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  69:   bp_cce_inst_read_dir_op_s    read_dir_op_s;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  70:   bp_cce_inst_write_dir_op_s   write_dir_op_s;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  71:   bp_cce_inst_misc_op_s        misc_op_s;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  72:   bp_cce_inst_queue_op_s       queue_op_s;</pre>
<pre style="margin:0; padding:0 ">  73: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  74:   logic pushq_op, popq_op, poph_op;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  75:   bp_cce_inst_dst_q_sel_e pushq_qsel;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  76:   bp_cce_inst_src_q_sel_e popq_qsel;</pre>
<pre style="margin:0; padding:0 ">  77: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  78:   logic [`bp_cce_num_src_q-1:0] wfq_v_vec;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  79:   logic [`bp_cce_num_src_q-1:0] wfq_mask;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  80:   logic wfq_op;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  81:   logic wfq_q_ready;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  82:   logic stall_op;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  83:   logic gpr_w_v;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  84:   logic wdp_op;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  85:   logic fence_op;</pre>
<pre style="margin:0; padding:0 ">  86: </pre>
<pre style="margin:0; padding:0 ">  87:   // Control outputs</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  88:   always_comb</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  89:   begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  90:     gpr_w_v = '0;</pre>
<pre style="margin:0; padding:0 ">  91: </pre>
<pre style="margin:0; padding:0 ">  92:     // reinterpret wires as instruction struct and fields</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  93:     inst = inst_i;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  94:     op = inst.op;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  95:     minor_op_u = inst.minor_op_u;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  96:     op_type_u = inst.type_u;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  97:     alu_op_s = op_type_u.alu_op_s;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  98:     branch_op_s = op_type_u.branch_op_s;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 ">  99:     mov_op_s = op_type_u.mov_op_s;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 100:     flag_op_s = op_type_u.flag_op_s;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 101:     read_dir_op_s = op_type_u.read_dir_op_s;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 102:     write_dir_op_s = op_type_u.write_dir_op_s;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 103:     misc_op_s = op_type_u.misc_op_s;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 104:     queue_op_s = op_type_u.queue_op_s;</pre>
<pre style="margin:0; padding:0 "> 105: </pre>
<pre style="margin:0; padding:0 "> 106:     // Defaults for outputs</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 107:     decoded_inst_v_o = '0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 108:     decoded_inst_o = '0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 109:     pc_stall_o = '0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 110:     pc_branch_target_o = '0;</pre>
<pre style="margin:0; padding:0 "> 111: </pre>
<pre style="margin:0; padding:0 "> 112:     // Pushq and Popq operation details - used for decoding and fetch control</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 113:     pushq_op = (op == e_op_queue) & (minor_op_u == e_pushq_op);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 114:     popq_op = (op == e_op_queue) & (minor_op_u == e_popq_op);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 115:     poph_op = (op == e_op_queue) & (minor_op_u == e_poph_op);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 116:     pushq_qsel = queue_op_s.op.pushq.dst_q;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 117:     popq_qsel = queue_op_s.op.popq.src_q;</pre>
<pre style="margin:0; padding:0 "> 118: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 119:     if (reset_i | ~inst_v_i) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 120:       decoded_inst_v_o = '0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 121:     end else begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 122:       decoded_inst_v_o = inst_v_i;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 123:       decoded_inst_o.op = op;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 124:       decoded_inst_o.minor_op_u = minor_op_u;</pre>
<pre style="margin:0; padding:0 "> 125: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 126:       case (op)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 127:         e_op_alu: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 128:           decoded_inst_o.alu_v = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 129:           // All ALU arithmetic operations write a GPR destination</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 130:           decoded_inst_o.alu_dst_w_v = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 131:           decoded_inst_o.imm[0+:`bp_cce_inst_imm16_width] = alu_op_s.imm;</pre>
<pre style="margin:0; padding:0 "> 132:           // Dst and Src fields are GPRs or immediate (src only)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 133:           decoded_inst_o.dst.gpr = alu_op_s.dst;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 134:           decoded_inst_o.src_a.gpr = alu_op_s.src_a;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 135:           decoded_inst_o.src_b.gpr = alu_op_s.src_b;</pre>
<pre style="margin:0; padding:0 "> 136: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 137:           decoded_inst_o.dst_sel = e_dst_sel_gpr;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 138:           decoded_inst_o.src_a_sel = e_src_sel_gpr;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 139:           decoded_inst_o.src_b_sel = e_src_sel_gpr;</pre>
<pre style="margin:0; padding:0 "> 140: </pre>
<pre style="margin:0; padding:0 "> 141:         end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 142:         e_op_branch: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 143:           decoded_inst_o.branch_v = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 144:           // Next PC computation</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 145:           decoded_inst_o.imm[0+:`bp_cce_inst_imm16_width] = branch_op_s.imm;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 146:           pc_branch_target_o = branch_op_s.target[0+:inst_addr_width_p];</pre>
<pre style="margin:0; padding:0 "> 147: </pre>
<pre style="margin:0; padding:0 "> 148:           // Default to GPR sources</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 149:           decoded_inst_o.src_a.gpr = branch_op_s.src_a.gpr;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 150:           decoded_inst_o.src_b.gpr = branch_op_s.src_b.gpr;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 151:           decoded_inst_o.src_a_sel = e_src_sel_gpr;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 152:           decoded_inst_o.src_b_sel = e_src_sel_gpr;</pre>
<pre style="margin:0; padding:0 "> 153: </pre>
<pre style="margin:0; padding:0 "> 154:           // Flag ops use flag as source A, immediate of 1 or 0 as source B</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 155:           if (minor_op_u.branch_minor_op == e_bf_op) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 156:             decoded_inst_o.src_a.flag = branch_op_s.src_a.flag;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 157:             decoded_inst_o.src_a_sel = e_src_sel_flag;</pre>
<pre style="margin:0; padding:0 "> 158: </pre>
<pre style="margin:0; padding:0 "> 159:           // Branch if queue.ready set, source B is immediate set to 1</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 160:           end else if (minor_op_u.branch_minor_op == e_bqv_op) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 161:             decoded_inst_o.src_a.special = branch_op_s.src_a.special;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 162:             decoded_inst_o.src_a_sel = e_src_sel_special;</pre>
<pre style="margin:0; padding:0 "> 163: </pre>
<pre style="margin:0; padding:0 "> 164:           // Branch if specail register equal to GPR/imm encoded src_b</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 165:           end else if (minor_op_u.branch_minor_op == e_bs_op) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 166:             decoded_inst_o.src_a.special = branch_op_s.src_a.special;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 167:             decoded_inst_o.src_a_sel = e_src_sel_special;</pre>
<pre style="margin:0; padding:0 "> 168:           end</pre>
<pre style="margin:0; padding:0 "> 169: </pre>
<pre style="margin:0; padding:0 "> 170:         end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 171:         e_op_move: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 172:           decoded_inst_o.mov_dst_w_v = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 173: </pre>
<pre style="margin:0; padding:0 "> 174:           // Dst and Src fields are GPRs or immediate (src only) by default</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 175:           decoded_inst_o.dst.gpr = mov_op_s.dst.gpr;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 176:           decoded_inst_o.src_a.gpr = mov_op_s.src.gpr;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 177:           decoded_inst_o.dst_sel = e_dst_sel_gpr;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 178:           decoded_inst_o.src_a_sel = e_src_sel_gpr;</pre>
<pre style="margin:0; padding:0 "> 179: </pre>
<pre style="margin:0; padding:0 "> 180:           // always set the immediate field</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 181:           decoded_inst_o.imm[0+:`bp_cce_inst_imm32_width] = mov_op_s.imm;</pre>
<pre style="margin:0; padding:0 "> 182: </pre>
<pre style="margin:0; padding:0 "> 183:           // move flag to gpr - src_a is a flag</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 184:           if (minor_op_u.mov_minor_op == e_movf_op) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 185:             decoded_inst_o.src_a.flag = mov_op_s.src.flag;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 186:             decoded_inst_o.src_a_sel = e_src_sel_flag;</pre>
<pre style="margin:0; padding:0 "> 187:           end</pre>
<pre style="margin:0; padding:0 "> 188:           // move special register to gpr - src_a is a special register</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 189:           else if (minor_op_u.mov_minor_op == e_movsg_op) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 190:             decoded_inst_o.src_a.special = mov_op_s.src.special;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 191:             decoded_inst_o.src_a_sel = e_src_sel_special;</pre>
<pre style="margin:0; padding:0 "> 192:           end</pre>
<pre style="margin:0; padding:0 "> 193:           // move gpr to special register - dst is a special register</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 194:           else if (minor_op_u.mov_minor_op == e_movgs_op) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 195:             decoded_inst_o.dst.special = mov_op_s.dst.special;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 196:             decoded_inst_o.dst_sel = e_dst_sel_special;</pre>
<pre style="margin:0; padding:0 "> 197:           end</pre>
<pre style="margin:0; padding:0 "> 198: </pre>
<pre style="margin:0; padding:0 "> 199:         end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 200:         e_op_flag: begin</pre>
<pre style="margin:0; padding:0 "> 201: </pre>
<pre style="margin:0; padding:0 "> 202:           // Flag ops always use flag for src_a and src_b</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 203:           decoded_inst_o.src_a.flag = flag_op_s.src_a;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 204:           decoded_inst_o.src_a_sel = e_src_sel_flag;</pre>
<pre style="margin:0; padding:0 "> 205: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 206:           decoded_inst_o.src_b.flag = flag_op_s.src_b;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 207:           decoded_inst_o.src_b_sel = e_src_sel_flag;</pre>
<pre style="margin:0; padding:0 "> 208: </pre>
<pre style="margin:0; padding:0 "> 209:           // immediate bit 0 always from instruction immediate</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 210:           decoded_inst_o.imm[0] = flag_op_s.val;</pre>
<pre style="margin:0; padding:0 "> 211: </pre>
<pre style="margin:0; padding:0 "> 212:           // destination - by default, destination is a flag register</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 213:           decoded_inst_o.dst.flag = flag_op_s.dst.flag;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 214:           decoded_inst_o.dst_sel = e_dst_sel_flag;</pre>
<pre style="margin:0; padding:0 "> 215: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 216:           if (minor_op_u.flag_minor_op == e_andf_op) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 217:             decoded_inst_o.minor_op_u.alu_minor_op = e_and_op;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 218:             decoded_inst_o.dst.gpr = flag_op_s.dst.gpr;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 219:             decoded_inst_o.dst_sel = e_dst_sel_gpr;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 220:             decoded_inst_o.alu_v = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 221:             decoded_inst_o.alu_dst_w_v = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 222:           end else if (minor_op_u.flag_minor_op == e_orf_op) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 223:             decoded_inst_o.minor_op_u.alu_minor_op = e_or_op;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 224:             decoded_inst_o.dst.gpr = flag_op_s.dst.gpr;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 225:             decoded_inst_o.dst_sel = e_dst_sel_gpr;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 226:             decoded_inst_o.alu_v = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 227:             decoded_inst_o.alu_dst_w_v = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 228:           end else begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 229:             if (flag_op_s.dst == e_dst_rqf) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 230:               decoded_inst_o.rqf_sel = e_rqf_imm0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 231:               decoded_inst_o.flag_mask_w_v = e_flag_rqf;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 232:             end else if (flag_op_s.dst == e_dst_ucf) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 233:               decoded_inst_o.rqf_sel = e_rqf_imm0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 234:               decoded_inst_o.flag_mask_w_v = e_flag_ucf;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 235:             end else if (flag_op_s.dst == e_dst_nerf) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 236:               decoded_inst_o.nerf_sel = e_nerf_imm0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 237:               decoded_inst_o.flag_mask_w_v = e_flag_nerf;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 238:             end else if (flag_op_s.dst == e_dst_ldf) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 239:               decoded_inst_o.ldf_sel = e_ldf_imm0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 240:               decoded_inst_o.flag_mask_w_v = e_flag_ldf;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 241:             end else if (flag_op_s.dst == e_dst_nwbf) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 242:               decoded_inst_o.nwbf_sel = e_nwbf_imm0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 243:               decoded_inst_o.flag_mask_w_v = e_flag_nwbf;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 244:             end else if (flag_op_s.dst == e_dst_tf) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 245:               decoded_inst_o.tf_sel = e_tf_imm0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 246:               decoded_inst_o.flag_mask_w_v = e_flag_tf;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 247:             end else if (flag_op_s.dst == e_dst_rf) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 248:               decoded_inst_o.rf_sel = e_rf_imm0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 249:               decoded_inst_o.flag_mask_w_v = e_flag_rf;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 250:             end else if (flag_op_s.dst == e_dst_pf) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 251:               decoded_inst_o.pf_sel = e_pf_imm0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 252:               decoded_inst_o.flag_mask_w_v = e_flag_pf;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 253:             end else if (flag_op_s.dst == e_dst_uf) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 254:               decoded_inst_o.uf_sel = e_uf_imm0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 255:               decoded_inst_o.flag_mask_w_v = e_flag_uf;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 256:             end else if (flag_op_s.dst == e_dst_if) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 257:               decoded_inst_o.if_sel = e_if_imm0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 258:               decoded_inst_o.flag_mask_w_v = e_flag_if;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 259:             end else if (flag_op_s.dst == e_dst_cf) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 260:               decoded_inst_o.cf_sel = e_cf_imm0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 261:               decoded_inst_o.flag_mask_w_v = e_flag_cf;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 262:             end else if (flag_op_s.dst == e_dst_cef) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 263:               decoded_inst_o.cef_sel = e_cef_imm0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 264:               decoded_inst_o.flag_mask_w_v = e_flag_cef;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 265:             end else if (flag_op_s.dst == e_dst_cof) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 266:               decoded_inst_o.cof_sel = e_cof_imm0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 267:               decoded_inst_o.flag_mask_w_v = e_flag_cof;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 268:             end else if (flag_op_s.dst == e_dst_cdf) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 269:               decoded_inst_o.cdf_sel = e_cdf_imm0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 270:               decoded_inst_o.flag_mask_w_v = e_flag_cdf;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 271:             end else if (flag_op_s.dst == e_dst_ucf) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 272:               decoded_inst_o.ucf_sel = e_ucf_imm0;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 273:               decoded_inst_o.flag_mask_w_v = e_flag_ucf;</pre>
<pre style="margin:0; padding:0 "> 274:             end</pre>
<pre style="margin:0; padding:0 "> 275:           end</pre>
<pre style="margin:0; padding:0 "> 276: </pre>
<pre style="margin:0; padding:0 "> 277:         end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 278:         e_op_read_dir: begin</pre>
<pre style="margin:0; padding:0 "> 279:           // Directory input mux selects</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 280:           decoded_inst_o.dir_way_group_sel = read_dir_op_s.dir_way_group_sel;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 281:           decoded_inst_o.dir_lce_sel = read_dir_op_s.dir_lce_sel;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 282:           decoded_inst_o.dir_way_sel = read_dir_op_s.dir_way_sel;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 283:           decoded_inst_o.dir_tag_sel = read_dir_op_s.dir_tag_sel;</pre>
<pre style="margin:0; padding:0 "> 284: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 285:           decoded_inst_o.dir_r_cmd = minor_op_u;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 286:           if (minor_op_u.read_dir_minor_op == e_rdp_op) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 287:             decoded_inst_o.pending_r_v = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 288:             decoded_inst_o.flag_mask_w_v = e_flag_pf;</pre>
<pre style="margin:0; padding:0 "> 289:           end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 290:           if (minor_op_u.read_dir_minor_op == e_rdw_op) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 291:             decoded_inst_o.dir_r_v = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 292:           end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 293:           if (minor_op_u.read_dir_minor_op == e_rde_op) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 294:             decoded_inst_o.dir_r_v = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 295:             decoded_inst_o.dst.gpr = read_dir_op_s.dst;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 296:             decoded_inst_o.dst_sel = e_dst_sel_gpr;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 297:             decoded_inst_o.rde_w_v = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 298:           end</pre>
<pre style="margin:0; padding:0 "> 299:         end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 300:         e_op_write_dir: begin</pre>
<pre style="margin:0; padding:0 "> 301:           // Directory input mux selects</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 302:           decoded_inst_o.dir_way_group_sel = write_dir_op_s.dir_way_group_sel;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 303:           decoded_inst_o.dir_lce_sel = write_dir_op_s.dir_lce_sel;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 304:           decoded_inst_o.dir_way_sel = write_dir_op_s.dir_way_sel;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 305:           decoded_inst_o.dir_coh_state_sel = write_dir_op_s.dir_coh_state_sel;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 306:           decoded_inst_o.dir_tag_sel = write_dir_op_s.dir_tag_sel;</pre>
<pre style="margin:0; padding:0 "> 307: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 308:           decoded_inst_o.dir_w_cmd = minor_op_u;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 309:           decoded_inst_o.dir_w_v = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 310: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 311:           decoded_inst_o.imm[0+:`bp_coh_bits] = write_dir_op_s.imm;</pre>
<pre style="margin:0; padding:0 "> 312: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 313:           if (minor_op_u.write_dir_minor_op == e_wdp_op) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 314:             decoded_inst_o.pending_w_v = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 315:           end</pre>
<pre style="margin:0; padding:0 "> 316:         end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 317:         e_op_misc: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 318:           if (minor_op_u.misc_minor_op == e_gad_op) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 319:             decoded_inst_o.gad_v = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 320:             decoded_inst_o.transfer_lce_w_v = 1'b1; // transfer_lce, transfer_lce_way</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 321:             decoded_inst_o.req_addr_way_w_v = 1'b1; // req_addr_way</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 322:             decoded_inst_o.transfer_lce_w_v = 1'b1; // transfer_lce, transfer_lce_way</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 323:             decoded_inst_o.tf_sel = e_tf_logic;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 324:             decoded_inst_o.rf_sel = e_rf_logic;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 325:             decoded_inst_o.uf_sel = e_uf_logic;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 326:             decoded_inst_o.if_sel = e_if_logic;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 327:             decoded_inst_o.cf_sel = e_cf_logic;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 328:             decoded_inst_o.cef_sel = e_cef_logic;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 329:             decoded_inst_o.cof_sel = e_cof_logic;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 330:             decoded_inst_o.cdf_sel = e_cdf_logic;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 331:             decoded_inst_o.flag_mask_w_v =</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 332:               (e_flag_tf | e_flag_rf | e_flag_uf | e_flag_if | e_flag_cf | e_flag_cef</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 333:                | e_flag_cof | e_flag_cdf);</pre>
<pre style="margin:0; padding:0 "> 334:           end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 335:           else if (minor_op_u.misc_minor_op == e_clm_op) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 336:             decoded_inst_o.mshr_clear = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 337:           end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 338:           else if (minor_op_u.misc_minor_op == e_fence_op) begin</pre>
<pre style="margin:0; padding:0 "> 339:           end</pre>
<pre style="margin:0; padding:0 "> 340:         end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 341:         e_op_queue: begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 342:           if (minor_op_u.queue_minor_op == e_pushq_op) begin</pre>
<pre style="margin:0; padding:0 "> 343:             // lce cmd</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 344:             decoded_inst_o.lce_cmd = queue_op_s.op.pushq.cmd.lce_cmd;</pre>
<pre style="margin:0; padding:0 "> 345:             // cce_lce_cmd_queue inputs</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 346:             decoded_inst_o.lce_cmd_lce_sel = queue_op_s.op.pushq.lce_cmd_lce_sel;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 347:             decoded_inst_o.lce_cmd_addr_sel = queue_op_s.op.pushq.lce_cmd_addr_sel;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 348:             decoded_inst_o.lce_cmd_way_sel = queue_op_s.op.pushq.lce_cmd_way_sel;</pre>
<pre style="margin:0; padding:0 "> 349:             // mem cmd</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 350:             decoded_inst_o.mem_cmd = queue_op_s.op.pushq.cmd.mem_cmd;</pre>
<pre style="margin:0; padding:0 "> 351:             // mem_cmd_queue inputs</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 352:             decoded_inst_o.mem_cmd_addr_sel = queue_op_s.op.pushq.mem_cmd_addr_sel;</pre>
<pre style="margin:0; padding:0 "> 353:             // mem_resp</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 354:             decoded_inst_o.mem_resp = queue_op_s.op.pushq.cmd.mem_resp;</pre>
<pre style="margin:0; padding:0 "> 355: </pre>
<pre style="margin:0; padding:0 "> 356:             // Output queue data valid signals</pre>
<pre style="margin:0; padding:0 "> 357:             // Output to LCE (ready&valid)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 358:             decoded_inst_o.lce_cmd_v = (pushq_qsel == e_dst_q_lce_cmd);</pre>
<pre style="margin:0; padding:0 "> 359:             // Output to Mem (ready&valid), connects to FIFO buffer</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 360:             decoded_inst_o.mem_cmd_v = (pushq_qsel == e_dst_q_mem_cmd);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 361:             decoded_inst_o.mem_resp_v = (pushq_qsel == e_dst_q_mem_resp);</pre>
<pre style="margin:0; padding:0 "> 362:       </pre>
<pre style="margin:0; padding:0 "> 363: </pre>
<pre style="margin:0; padding:0 "> 364:           end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 365:           if ((minor_op_u.queue_minor_op == e_popq_op)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 366:               | (minor_op_u.queue_minor_op == e_poph_op)) begin</pre>
<pre style="margin:0; padding:0 "> 367: </pre>
<pre style="margin:0; padding:0 "> 368:             // only dequeue if actually a POPQ op, not a POPH op</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 369:             if (minor_op_u.queue_minor_op == e_popq_op) begin</pre>
<pre style="margin:0; padding:0 "> 370:               // Input queue yumi signals (to FIFOs)</pre>
<pre style="margin:0; padding:0 "> 371:               // Input messages are buffered by FIFOs, and dequeueing uses valid->yumi protocol</pre>
<pre style="margin:0; padding:0 "> 372:               // Input from LCE (valid->yumi)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 373:               decoded_inst_o.lce_req_yumi = lce_req_v_i & (popq_qsel == e_src_q_sel_lce_req);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 374:               decoded_inst_o.lce_resp_yumi = lce_resp_v_i & (popq_qsel == e_src_q_sel_lce_resp);</pre>
<pre style="margin:0; padding:0 "> 375:               // Input from Mem (valid->yumi)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 376:               decoded_inst_o.mem_resp_yumi = mem_resp_v_i & (popq_qsel == e_src_q_sel_mem_resp);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 377:               decoded_inst_o.mem_cmd_yumi = mem_cmd_v_i & (popq_qsel == e_src_q_sel_mem_cmd);</pre>
<pre style="margin:0; padding:0 "> 378:             end</pre>
<pre style="margin:0; padding:0 "> 379: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 380:             if (queue_op_s.op.popq.src_q == e_src_q_sel_lce_resp) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 381:               decoded_inst_o.nwbf_sel = e_nwbf_lce_resp;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 382:               decoded_inst_o.flag_mask_w_v = e_flag_nwbf;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 383:               decoded_inst_o.dst.gpr = queue_op_s.op.popq.dst;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 384:               decoded_inst_o.dst_sel = e_dst_sel_gpr;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 385:               decoded_inst_o.resp_type_w_v = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 386: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 387:             end else if (queue_op_s.op.popq.src_q == e_src_q_sel_mem_resp) begin</pre>
<pre style="margin:0; padding:0 "> 388:               // pop the response type into a GPR</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 389:               decoded_inst_o.dst.gpr = queue_op_s.op.popq.dst;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 390:               decoded_inst_o.dst_sel = e_dst_sel_gpr;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 391:               decoded_inst_o.mem_resp_type_w_v = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 392: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 393:             end else if (queue_op_s.op.popq.src_q == e_src_q_sel_mem_cmd) begin</pre>
<pre style="margin:0; padding:0 "> 394:               // pop the command into a GPR</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 395:               decoded_inst_o.dst.gpr = queue_op_s.op.popq.dst;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 396:               decoded_inst_o.dst_sel = e_dst_sel_gpr;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 397:               decoded_inst_o.mem_cmd_type_w_v = 1'b1;</pre>
<pre style="margin:0; padding:0 "> 398:               // store address and lce fields to special registers</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 399:               decoded_inst_o.req_w_v = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 400:               decoded_inst_o.req_sel = e_req_sel_mem_cmd;</pre>
<pre style="margin:0; padding:0 "> 401: </pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 402:             end else if (queue_op_s.op.popq.src_q == e_src_q_sel_lce_req) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 403:               decoded_inst_o.req_sel = e_req_sel_lce_req;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 404:               decoded_inst_o.lru_way_sel = e_lru_way_sel_lce_req;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 405:               decoded_inst_o.req_w_v = 1'b1; // req_lce, req_addr</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 406:               decoded_inst_o.lru_way_w_v = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 407:               decoded_inst_o.nerf_sel = e_nerf_lce_req;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 408:               decoded_inst_o.ldf_sel = e_ldf_lce_req;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 409:               decoded_inst_o.rqf_sel = e_rqf_lce_req;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 410:               decoded_inst_o.ucf_sel = e_ucf_lce_req;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 411:               decoded_inst_o.nc_req_size_w_v = 1'b1;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 412:               decoded_inst_o.flag_mask_w_v = (e_flag_rqf | e_flag_nerf | e_flag_ldf | e_flag_ucf);</pre>
<pre style="margin:0; padding:0 "> 413:             end</pre>
<pre style="margin:0; padding:0 "> 414:           end</pre>
<pre style="margin:0; padding:0 "> 415:         end</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 416:         default: begin</pre>
<pre style="margin:0; padding:0 "> 417:         end</pre>
<pre style="margin:0; padding:0 "> 418:       endcase</pre>
<pre style="margin:0; padding:0 "> 419: </pre>
<pre style="margin:0; padding:0 "> 420:       // Write enables</pre>
<pre style="margin:0; padding:0 "> 421: </pre>
<pre style="margin:0; padding:0 "> 422:       // GPR writes occur for mov op, alu op, and LCE Response type pop - only if dst_sel is GPR</pre>
<pre style="margin:0; padding:0 "> 423:       // TODO: consolidate signals into a gpr_w_v signal in decoded_inst</pre>
<pre style="margin:0; padding:0 "> 424:       // -- need to make sure signals are not used directly elsewhere</pre>
<pre style="margin:0; padding:0 "> 425:       // -- may need a select signal for gpr_n values</pre>
<pre style="margin:0; padding:0 "> 426:       //    -- alu_result</pre>
<pre style="margin:0; padding:0 "> 427:       //    -- move_src (same as alu_src_a?)</pre>
<pre style="margin:0; padding:0 "> 428:       //    -- lce_resp_type</pre>
<pre style="margin:0; padding:0 "> 429:       //    -- mem_resp_type</pre>
<pre style="margin:0; padding:0 "> 430:       //    -- directory_tag_output - from RDE op</pre>
<pre style="margin:0; padding:0 "> 431:       //    --</pre>
<pre style="margin:0; padding:0 "> 432:       //    --</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 433:       gpr_w_v = (decoded_inst_o.mov_dst_w_v | decoded_inst_o.alu_dst_w_v</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 434:                  | decoded_inst_o.resp_type_w_v | decoded_inst_o.rde_w_v</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 435:                  | decoded_inst_o.mem_resp_type_w_v)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 436:                 & (decoded_inst_o.dst_sel == e_dst_sel_gpr);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 437:       decoded_inst_o.gpr_w_mask =</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 438:         {</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 439:         (decoded_inst_o.dst.gpr == e_dst_r7) & (gpr_w_v)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 440:         ,(decoded_inst_o.dst.gpr == e_dst_r6) & (gpr_w_v)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 441:         ,(decoded_inst_o.dst.gpr == e_dst_r5) & (gpr_w_v)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 442:         ,(decoded_inst_o.dst.gpr == e_dst_r4) & (gpr_w_v)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 443:         ,(decoded_inst_o.dst.gpr == e_dst_r3) & (gpr_w_v)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 444:         ,(decoded_inst_o.dst.gpr == e_dst_r2) & (gpr_w_v)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 445:         ,(decoded_inst_o.dst.gpr == e_dst_r1) & (gpr_w_v)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 446:         ,(decoded_inst_o.dst.gpr == e_dst_r0) & (gpr_w_v)</pre>
<pre style="margin:0; padding:0 "> 447:         };</pre>
<pre style="margin:0; padding:0 "> 448: </pre>
<pre style="margin:0; padding:0 "> 449:       // Uncached data</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 450:       decoded_inst_o.nc_data_w_v = (popq_op) & (popq_qsel == e_src_q_sel_lce_req);</pre>
<pre style="margin:0; padding:0 "> 451: </pre>
<pre style="margin:0; padding:0 "> 452:     end</pre>
<pre style="margin:0; padding:0 "> 453: </pre>
<pre style="margin:0; padding:0 "> 454:     // Control for fetch</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 455:     wfq_op = (op == e_op_queue) & (minor_op_u.queue_minor_op == e_wfq_op);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 456:     stall_op = (op == e_op_misc) & (minor_op_u.misc_minor_op == e_stall_op);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 457:     wdp_op = (op == e_op_write_dir) & (minor_op_u.write_dir_minor_op == e_wdp_op);</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 458:     fence_op = (op == e_op_misc) & (minor_op_u.misc_minor_op == e_fence_op);</pre>
<pre style="margin:0; padding:0 "> 459: </pre>
<pre style="margin:0; padding:0 "> 460:     // vector of input queue valid signals</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 461:     wfq_v_vec = {mem_cmd_v_i, lce_req_v_i, lce_resp_v_i, mem_resp_v_i, pending_v_i};</pre>
<pre style="margin:0; padding:0 "> 462:     // WFQ mask from instruction immediate</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 463:     wfq_mask = queue_op_s.op.wfq.qmask;</pre>
<pre style="margin:0; padding:0 "> 464: </pre>
<pre style="margin:0; padding:0 "> 465:     // wfq_q_ready is high if any of the selected queues in the mask are ready</pre>
<pre style="margin:0; padding:0 "> 466:     // wfq_q_ready is low if none of the selected queues in the mask are ready</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 467:     wfq_q_ready = |(wfq_mask & wfq_v_vec);</pre>
<pre style="margin:0; padding:0 "> 468: </pre>
<pre style="margin:0; padding:0 "> 469:     // stall PC if WFQ instruction and none of the target queues are ready</pre>
<pre style="margin:0; padding:0 "> 470:     // stall outputs a valid instruction, but does not advance the PC</pre>
<pre style="margin:0; padding:0 "> 471:     // also stall if fence op and fence count is not zero</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 472:     pc_stall_o = stall_op | (wfq_op & ~wfq_q_ready)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 473:                  | (fence_op & ~fence_zero_i);</pre>
<pre style="margin:0; padding:0 "> 474: </pre>
<pre style="margin:0; padding:0 "> 475:     // stall PC if PUSHQ instruction and target output queue is not ready for data</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 476:     if (pushq_op) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 477:     case (pushq_qsel)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 478:       e_dst_q_lce_cmd: pc_stall_o |= ~lce_cmd_ready_i;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 479:       e_dst_q_mem_cmd: pc_stall_o |= ~mem_cmd_ready_i;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 480:       e_dst_q_mem_resp: pc_stall_o |= ~mem_resp_ready_i;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 481:       default: pc_stall_o = pc_stall_o;</pre>
<pre style="margin:0; padding:0 "> 482:     endcase</pre>
<pre style="margin:0; padding:0 "> 483:     end</pre>
<pre style="margin:0; padding:0 "> 484: </pre>
<pre style="margin:0; padding:0 "> 485:     // stall PC if POPQ or POPH instruction and target queue has no valid data on its output</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 486:     if (popq_op | poph_op) begin</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 487:     case (popq_qsel)</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 488:       e_src_q_sel_lce_req: pc_stall_o |= ~lce_req_v_i;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 489:       e_src_q_sel_mem_resp: pc_stall_o |= ~mem_resp_v_i;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 490:       e_src_q_sel_lce_resp: pc_stall_o |= ~lce_resp_v_i;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 491:       e_src_q_sel_mem_cmd: pc_stall_o |= ~mem_cmd_v_i;</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 492:       default: pc_stall_o = pc_stall_o;</pre>
<pre style="margin:0; padding:0 "> 493:     endcase</pre>
<pre style="margin:0; padding:0 "> 494:     end</pre>
<pre style="margin:0; padding:0 "> 495: </pre>
<pre style="margin:0; padding:0 "> 496:     // stall if trying to push mem_cmd but bp_cce_msg is using the pending bit</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 497:     pc_stall_o |= (pushq_op & (pushq_qsel == e_dst_q_mem_cmd) & pending_w_busy_i);</pre>
<pre style="margin:0; padding:0 "> 498: </pre>
<pre style="margin:0; padding:0 "> 499:     // stall if trying to push lce_cmd but bp_cce_msg is sending an lce_cmd</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 500:     pc_stall_o |= (pushq_op & (pushq_qsel == e_dst_q_lce_cmd) & lce_cmd_busy_i);</pre>
<pre style="margin:0; padding:0 "> 501: </pre>
<pre style="margin:0; padding:0 "> 502:     // stall if current op is WDP but bp_cce_msg is writing the pending bits</pre>
<pre style="background-color: #C0C0C0; margin:0; padding:0 "> 503:     pc_stall_o |= (wdp_op & pending_w_busy_i);</pre>
<pre style="margin:0; padding:0 "> 504: </pre>
<pre style="margin:0; padding:0 "> 505:   end</pre>
<pre style="margin:0; padding:0 "> 506: </pre>
<pre style="margin:0; padding:0 "> 507: endmodule</pre>
<pre style="margin:0; padding:0 "> 508: </pre>
</body>
</html>
